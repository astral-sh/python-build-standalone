diff --git a/Modules/blake2module.c b/Modules/blake2module.c
--- a/Modules/blake2module.c
+++ b/Modules/blake2module.c
@@ -33,7 +33,7 @@
 // pulled into the build automatically, and then only the CPU autodetection will
 // need to be updated here.
 
-#if defined(__x86_64__) && defined(__GNUC__)
+#if defined(__x86_64__) && defined(__GLIBC__)
 #include <cpuid.h>
 #elif defined(_M_X64)
 #include <intrin.h>
@@ -76,7 +76,7 @@ void detect_cpu_features(cpu_flags *flags) {
   if (!flags->done) {
     int eax1 = 0, ebx1 = 0, ecx1 = 0, edx1 = 0;
     int eax7 = 0, ebx7 = 0, ecx7 = 0, edx7 = 0;
-#if defined(__x86_64__) && defined(__GNUC__)
+#if defined(__x86_64__) && defined(__GNULIBC__)
     __cpuid_count(1, 0, eax1, ebx1, ecx1, edx1);
     __cpuid_count(7, 0, eax7, ebx7, ecx7, edx7);
 #elif defined(_M_X64)
